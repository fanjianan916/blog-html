<!DOCTYPE html>
<html>
<head>
  <title>BeanNan~Blog</title>
  
  <!-- meta -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- css -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <link rel="stylesheet" href="css/pace.css">
  <link rel="stylesheet" href="css/custom.css">
  
  <!-- js -->
  <script src="js/jquery-2.1.3.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/pace.min.js"></script>
  <script src="js/modernizr.custom.js"></script>
  <script src="js/showdown.js"></script>
  <link href="http://apps.bdimg.com/libs/highlight.js/9.1.0/styles/default.min.css" rel="stylesheet">
  <!--<script>hljs.initHighlightingOnLoad();</script>-->

</head>

<body id="single">
<div class="container">
  <header id="site-header">
    <div class="row">
      <div class="col-md-4 col-sm-5 col-xs-8">
        <div class="logo">
          <h1><a href="index.html"><b>BeanNan</b></a></h1>
        </div>
      </div><!-- col-md-4 -->
      <div class="col-md-8 col-sm-7 col-xs-4">
        <nav class="main-nav" role="navigation">
          <div class="navbar-header">
            <button type="button" id="trigger-overlay" class="navbar-toggle">
              <span class="ion-navicon"></span>
            </button>
          </div>
          
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
            </ul>
          </div><!-- /.navbar-collapse -->
        </nav>
        <div id="header-search-box">
          <a id="search-menu" href="#"><span id="search-icon" class="ion-ios-search-strong"></span></a>
          <div id="search-form" class="search-form">
            <form role="search" method="get" id="searchform" action="#">
              <input type="search" placeholder="搜索" required>
              <button type="submit"><span class="ion-ios-search-strong"></span></button>
            </form>
          </div>
        </div>
      </div><!-- col-md-8 -->
    </div>
  </header>
</div>

<div class="content-body">
  <div class="container">
    <div class="row">
      <main class="col-md-8">
        <article class="post post-1">
          
          <header class="entry-header setFont" id="artile_title">
          
          </header>
          <div class="entry-content clearfix" id="markId">
          </div>
        
        </article>
      
      </main>
      <aside class="col-md-4">
        
        <div class="widget widget-recent-posts">
          <h3 class="widget-title">最新文章</h3>
          
          <ul id="lastArticles">
          
          </ul>
        
        
        </div>
        <div class="widget widget-category">
          <h3 class="widget-title">分类</h3>
          <ul id="categorys">
          
          </ul>
        </div>
        <div class="widget widget-tag-cloud">
          <h3 class="widget-title">标签云</h3>
          <ul id="tags">
          
          
          </ul>
        </div>
      
      </aside>
    </div>
  </div>
</div>
<footer id="site-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <p class="copyright">BeanNan
        </p>
      </div>
    </div>
  </div>
</footer>

<!-- Mobile Menu -->
<div class="overlay overlay-hugeinc">
  <button type="button" class="overlay-close"><span class="ion-ios-close-empty"></span></button>
  <nav>
    <ul>
      <li><a href="index.html">首页</a></li>
      <li><a href="blog-list.html">博客</a></li>
      <li><a href="about.html">关于</a></li>
      <li><a href="contact.html">联系</a></li>
    </ul>
  </nav>
</div>

<script src="js/script.js"></script>
<script>
  
  $(() => {
    function getQueryStringArgs() {
      var qs = (location.search.length > 0 ? location.search.substring(1) : ""),
          args = {},
          items = qs.length ? qs.split("&") : [],
          item = null,
          name = null,
          value = null,
          i = 0,
          len = items.length;
      for (i = 0; i < len; i++) {
        item = items[i].split("=");
        name = decodeURIComponent(item[0]);
        value = decodeURIComponent(item[1]);
        if (name.length) {
          args[name] = value;
        }
      }
      return args;
    }
    
    let args = getQueryStringArgs();
    let article_id = args['article_id'];
    
    $.get("http://localhost:8082/articles/" + article_id, function (result) {
      let time = new Date(result.update_time).toLocaleDateString();
      let header = "<h1 class=\"entry-title\">" + result.article_name + "</h1>\n" +
          "          <div class=\"entry-meta\">\n" +
          "          <span class=\"post-category\"><a href=\"#\">" + result.category.category_name + "</a></span>\n" +
          "          <span class=\"post-date\"><a href=\"#\"><time class=\"entry-date\"\n" +
          "          >" + time + "</time></a></span>\n" +
          "          <span class=\"post-author\"><a href=\"#\">BeanNan</a></span>\n" +
          "          <span class=\"views-count\"><a href=\"#\">" + result.read_num + " 阅读</a></span>\n" +
          "          </div>";
      $("#artile_title").html(header);
  
      let converter = new showdown.Converter({
        'github_flavouring': true,
        'tables': true
      });
      let html = converter.makeHtml(result.content);
      let markId = $("#markId");
      markId.html(html);
    });
    
    //获取最新文章
    $.get("http://localhost:8082/articlelast", function (result) {
      let data = result.data;
      let lastHTML = "";
      for (let i = 0; i < data.length; i++) {
        let article = data[i];
        lastHTML += "<li>\n" +
            "              <a href=\"single.html?article_id=" + article.article_id + "\">" + article.article_name + "</a>\n" +
            "            </li>";
      }
      
      $("#lastArticles").html(lastHTML);
      
    })
    //获取分类
    $.get("http://localhost:8082/categorys", function (result) {
      let data = result.data;
      let lastHTML = "";
      for (let i = 0; i < data.length; i++) {
        let category = data[i];
        lastHTML += "<li>\n" +
            "              <a href=\"#\">" + category.category_name + " <span class=\"post-count\"></span></a>\n" +
            "            </li>";
      }
      
      $("#categorys").html(lastHTML);
      
      $.get("http://localhost:8082/tags", function (result) {
        let data = result.data;
        let lastHTML = "";
        for (let i = 0; i < data.length; i++) {
          let tag = data[i];
          lastHTML += "<li>\n" +
              "              <a href=\"#\">" + tag.tag_name + "</a>\n" +
              "            </li>";
        }
        
        $("#tags").html(lastHTML);
      })
    });
  });

</script>
</body>
</html>
